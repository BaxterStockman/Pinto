Revision Workflow-

Begin txn
rev = new revision
stack.head = revision

On INSERT:

  asssert registration.stack.head.is_committed == 0;

  registration_history = registration
  registration_history.created_in_revision = registration.stack.head

On DELETE:

  registration_history.deleted_in_revision = registration.stack.head

revision.is_committed = 1
Commit txn
